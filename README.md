# TradeUpSPY - Calculadora de Trade-Ups de CS2

[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Code Style: Black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)

Calculadora avanzada en Python que replica con precisi√≥n matem√°tica la l√≥gica de TradeUpSpy para evaluar la rentabilidad de contratos de CS2. Incluye integraci√≥n con CSFloat API, an√°lisis de riesgo, y interfaz CLI profesional.

## ‚ú® Caracter√≠sticas Principales

- **üéØ Precisi√≥n Matem√°tica**: Replica exactamente los c√°lculos de TradeUpSpy
- **üìä An√°lisis Completo**: EV, ROI, probabilidades, y an√°lisis de riesgo
- **üîÑ Precios en Tiempo Real**: Integraci√≥n con CSFloat API
- **üìã Validaci√≥n Autom√°tica**: Verifica reglas de CS2 autom√°ticamente
- **üé® Interfaz Rica**: Tablas formateadas con Rich para m√°xima claridad
- **‚ö° Alto Rendimiento**: Cach√© inteligente y manejo de rate limits

## üìö Documentaci√≥n Completa

- **[Gu√≠a de Contratos](docs/guia_contratos.md)**: Mec√°nicas de CS2 y f√≥rmulas matem√°ticas
- **[API CSFloat](docs/api_csfloat.md)**: Integraci√≥n y endpoints soportados
- **[TL;DR de API CSFloat](docs/api_csfloat.md#tldr)**: Resumen accionable con filtros y ejemplos
- **[Arquitectura](docs/structure.md)**: Estructura del proyecto y patrones de dise√±o
- **[Stack T√©cnico](docs/tech.md)**: Tecnolog√≠as, convenciones y gu√≠as de desarrollo
- **[Visi√≥n del Producto](docs/product.md)**: Objetivos, usuarios objetivo y roadmap

### ‚ö° Atajos CSFloat (TL;DR)

| Caso | Ejemplo |
|------|---------|
| Listar por nombre con float bajo | `curl -s -H "accept: application/json" -H "authorization: $CSFLOAT_API_KEY" "https://csfloat.com/api/v1/listings?market_hash_name=AK-47%20%7C%20Redline%20(Field-Tested)&max_float=0.16&limit=50&sort_by=lowest_float"` |
| Detalle por ID | `curl -s -H "accept: application/json" -H "authorization: $CSFLOAT_API_KEY" "https://csfloat.com/api/v1/listings/<ID>"` |
| Crear listing (buy_now) | `curl -s -X POST "https://csfloat.com/api/v1/listings" -H "accept: application/json" -H "authorization: $CSFLOAT_API_KEY" -H "content-type: application/json" -d '{"asset_id":"21078095468","type":"buy_now","price":8900}'` |

## üöÄ Instalaci√≥n R√°pida

### Requisitos del Sistema
- **Python 3.10+** (verificar con `python --version`)
- **Sistema Operativo**: Windows, macOS, Linux
- **Conexi√≥n a Internet**: Para precios en tiempo real (opcional)

### Instalaci√≥n
```bash
# 1. Clonar el repositorio
git clone https://github.com/falopp/TradeupSPY.git
cd TradeUpSPY

# 2. Crear entorno virtual (recomendado)
python -m venv venv
venv\Scripts\activate  # Windows
source venv/bin/activate  # macOS/Linux

# 3. Instalar dependencias
python -m pip install -r requirements.txt

# 4. Verificar instalaci√≥n
python -m tradeup.cli --help
```

### Configuraci√≥n de API (Opcional)
```bash
# Copiar template de configuraci√≥n
cp .env.example .env

# Editar .env con tu API key de CSFloat
CSFLOAT_API_KEY=tu_api_key_aqui
CSFLOAT_BASE=https://csfloat.com
```

> **üí° Tip**: Puedes usar la herramienta sin API key utilizando precios locales con `--no-fetch-prices`

## üìÅ Formatos de Datos

### Cat√°logo de Skins (`data/skins.csv`)
Contiene la base de datos completa de skins con sus propiedades:

```csv
Arma,Coleccion,Grado,FloatMin,FloatMax
"AK-47 | Cartel","The Chroma Collection","restricted",0.00,0.75
"M4A4 | ÈæçÁéã (Dragon King)","The Chroma Collection","restricted",0.00,0.75
```

| Campo | Descripci√≥n | Ejemplo |
|-------|-------------|---------|
| `Arma` | Nombre completo de la skin | `"AK-47 \| Cartel"` |
| `Coleccion` | Colecci√≥n a la que pertenece | `"The Chroma Collection"` |
| `Grado` | Rareza de la skin | `"restricted"` |
| `FloatMin` | Float m√≠nimo posible | `0.00` |
| `FloatMax` | Float m√°ximo posible | `0.75` |

### Contrato CSV (`contracts/*.csv`)
Define las 10 skins de entrada para el trade-up:

```csv
Name,Collection,Rarity,Float,PriceCents,StatTrak
"MP9 | Deadly Poison","The Chroma Collection","mil-spec",0.09,1250,false
"SCAR-20 | Grotto","The Chroma Collection","mil-spec",0.12,890,false
```

| Campo | Requerido | Descripci√≥n | Ejemplo |
|-------|-----------|-------------|---------|
| `Name` | ‚úÖ | Nombre exacto (debe existir en cat√°logo) | `"MP9 \| Deadly Poison"` |
| `Collection` | ‚úÖ | Colecci√≥n (debe coincidir con cat√°logo) | `"The Chroma Collection"` |
| `Rarity` | ‚úÖ | Rareza en min√∫sculas | `"mil-spec"` |
| `Float` | ‚úÖ | Valor de float (0.0-1.0) | `0.09` |
| `PriceCents` | ‚ùå | Precio en centavos (se consulta API si falta) | `1250` |
| `StatTrak` | ‚ùå | StatTrak‚Ñ¢ (true/false, default: false) | `false` |

### Precios Locales (Opcional)
Dos formatos soportados para `--local-prices`:

#### Formato 1: Market Hash Name
```csv
MarketHashName,PriceCents
"AK-47 | Cartel (Field-Tested)",8900
"StatTrak‚Ñ¢ M4A4 | ÈæçÁéã (Dragon King) (Minimal Wear)",15600
```

#### Formato 2: Componentes Separados
```csv
Name,Wear,PriceCents,StatTrak
"AK-47 | Cartel","Field-Tested",8900,false
"M4A4 | ÈæçÁéã (Dragon King)","Minimal Wear",15600,true
```

> **üí° Nota**: Los precios siempre deben estar en **centavos** (ej: $89.00 = 8900 centavos)

## üíª Gu√≠a de Uso

### Casos de Uso Comunes

#### 1. An√°lisis B√°sico (Sin API)
Perfecto para aprender o cuando no tienes API key:
```bash
python -m tradeup.cli \
  --contract contracts/ejemplo_contrato.csv \
  --catalog data/skins.csv \
  --no-fetch-prices
```

#### 2. An√°lisis con Precios Locales
Usa tus propios precios para escenarios espec√≠ficos:
```bash
python -m tradeup.cli \
  --contract contracts/ejemplo_contrato.csv \
  --catalog data/skins.csv \
  --no-fetch-prices \
  --local-prices docs/local_prices.example.csv
```

#### 3. An√°lisis en Tiempo Real
Precios actuales del mercado CSFloat:
```bash
python -m tradeup.cli \
  --contract contracts/ejemplo_contrato.csv \
  --catalog data/skins.csv
```

#### 4. An√°lisis Avanzado
Con comisiones personalizadas y cat√°logo actualizado:
```bash
python -m tradeup.cli \
  --contract contracts/ejemplo_contrato.csv \
  --catalog data/skins_fixed.csv \
  --fees 0.15 \
  --fetch-prices
```

### Par√°metros de L√≠nea de Comandos

| Par√°metro | Tipo | Default | Descripci√≥n |
|-----------|------|---------|-------------|
| `--contract` | string | **requerido** | Ruta al CSV del contrato (10 entradas exactas) |
| `--catalog` | string | `data/skins.csv` | Ruta al cat√°logo de skins |
| `--fees` | float | `0.02` | Tasa de comisiones (0.02 = 2% CSFloat) |
| `--fetch-prices` | flag | `true` | Consultar precios a CSFloat API |
| `--no-fetch-prices` | flag | `false` | Usar solo precios locales |
| `--local-prices` | string | - | CSV con precios personalizados |

### Formatos de Salida

La herramienta genera tablas formateadas con:
- **üìã Resumen del Contrato**: Validaci√≥n y estad√≠sticas b√°sicas
- **üí∞ An√°lisis de Entradas**: Precios y floats de las 10 skins de entrada
- **üéØ Resultados Posibles**: Probabilidades y valores esperados
- **üìä M√©tricas de Rentabilidad**: EV, ROI, mejor/peor caso
- **‚ö†Ô∏è Advertencias**: Problemas detectados y recomendaciones

## Reglas implementadas (resumen)

- Siempre 10 skins y todas de la misma rareza.
- No se puede mezclar StatTrak‚Ñ¢ con no‚ÄëStatTrak‚Ñ¢.
- Souvenir no es soportado (no incluir en el contrato).
- Progresi√≥n de rarezas: consumer ‚Üí industrial ‚Üí mil‚Äëspec ‚Üí restricted ‚Üí classified ‚Üí covert.
- C√°lculo de float de salida: promedio de floats normalizados y remapeo al rango de la skin de salida.

### Modelo de probabilidades

Se utiliza el modelo de "pool de outcomes" (como TradeUpSpy):

```
S = sum_C (n_C * m_C)
P(outcome j en C) = n_C / S
```

Donde `n_C` es la cantidad de entradas de la colecci√≥n C y `m_C` la cantidad de outcomes en la rareza objetivo para C.

### EV y ROI

- `EV = sum_j (Precio_j * Prob_j)`
- `EV_neto = EV * (1 - fees)`
- `ROI_neto = (EV_neto - costo_entradas) / costo_entradas`

Los precios se consultan por `market_hash_name` construido como:
- `"AK-47 | Cartel (Field-Tested)"`
- `"StatTrak‚Ñ¢ AK-47 | Cartel (Field-Tested)"`

## Formato del contrato CSV

Columnas requeridas:

- `Name`: nombre exacto de la skin (debe existir en el cat√°logo con esa colecci√≥n y rareza).
- `Collection`: nombre de colecci√≥n igual al cat√°logo (p. ej., `The Chroma Collection`).
- `Rarity`: rareza en min√∫sculas (`consumer|industrial|mil-spec|restricted|classified|covert`).
- `Float`: float de la entrada (0.0‚Äì1.0).

Columnas opcionales:

- `PriceCents`: costo de compra de la entrada en centavos. Si no se brinda y `--fetch-prices` est√° activo, se consulta a CSFloat seg√∫n el wear inferido por el float.
- `StatTrak`: `true/false`.

## Manejo de errores

- Validaci√≥n de tama√±o del contrato (10 entradas), rareza homog√©nea y StatTrak homog√©neo.
- Verificaci√≥n de existencia en el cat√°logo y de rangos de floats.
- Reintentos y manejo de rate limit (HTTP 429) al consultar CSFloat.
- Salida clara de errores en CLI con mensajes amigables.

## Limitaciones conocidas

- No se soportan contratos Souvenir.
- El `market_hash_name` inferido usa los nombres de wear est√°ndar. Puede haber casos raros (p. ej., skins sin cierto wear) donde el √≠tem exacto no exista.
- El modelo cl√°sico de probabilidades (colecci√≥n uniforme) no est√° implementado (se deja como posible mejora).

## üõ†Ô∏è Soluci√≥n de Problemas

### Errores Comunes

#### Error: "ModuleNotFoundError: No module named 'rich'"
```bash
# Soluci√≥n: Instalar dependencias
python -m pip install -r requirements.txt
```

#### Error: "CSFLOAT_API_KEY environment variable not set"
```bash
# Soluci√≥n 1: Usar archivo .env
cp .env.example .env
# Editar .env con tu API key

# Soluci√≥n 2: Variable de entorno temporal
export CSFLOAT_API_KEY="tu_api_key"  # Linux/macOS
set CSFLOAT_API_KEY=tu_api_key       # Windows CMD
$env:CSFLOAT_API_KEY="tu_api_key"    # Windows PowerShell

# Soluci√≥n 3: Usar sin API
python -m tradeup.cli --contract contracts/ejemplo_contrato.csv --no-fetch-prices
```

#### Error: "HTTP 429 Too Many Requests"
```bash
# Soluci√≥n: Esperar y reintentar (rate limit de CSFloat)
# La herramienta maneja autom√°ticamente los reintentos
# Si persiste, espera 60 segundos antes de volver a ejecutar
```

#### Error: "Contract must have exactly 10 entries"
```bash
# Soluci√≥n: Verificar el CSV del contrato
python -c "
import pandas as pd
df = pd.read_csv('contracts/ejemplo_contrato.csv')
print(f'Entradas encontradas: {len(df)}')
print(df[['Name', 'Collection', 'Rarity']].head())
"
```

### Validaci√≥n de Datos

#### Verificar Cat√°logo
```bash
python -c "
from tradeup.csv_loader import load_catalog
catalog = load_catalog('data/skins.csv')
print(f'Skins cargadas: {len(catalog)}')
print(f'Colecciones √∫nicas: {len(set(item.collection for item in catalog))}')
"
```

#### Verificar Contrato
```bash
python -c "
from tradeup.csv_loader import load_contract
contract = load_contract('contracts/ejemplo_contrato.csv')
print(f'Entradas: {len(contract)}')
for entry in contract[:3]:
    print(f'- {entry.name} ({entry.rarity}) Float: {entry.float_value}')
"
```

## üë®‚Äçüíª Desarrollo y Contribuci√≥n

### Estructura del Proyecto
```
tradeup/
‚îú‚îÄ‚îÄ models.py      # üèóÔ∏è  Modelos de dominio y estructuras de datos
‚îú‚îÄ‚îÄ csv_loader.py  # üìÑ  Carga y validaci√≥n de archivos CSV
‚îú‚îÄ‚îÄ contracts.py   # üßÆ  L√≥gica de negocio y c√°lculos matem√°ticos
‚îú‚îÄ‚îÄ csfloat_api.py # üåê  Cliente API con reintentos y cach√©
‚îú‚îÄ‚îÄ pricing.py     # üí∞  Gesti√≥n de precios multi-fuente
‚îî‚îÄ‚îÄ cli.py         # üñ•Ô∏è  Interfaz de l√≠nea de comandos
```

### Configuraci√≥n de Desarrollo
```bash
# Instalar dependencias de desarrollo
python -m pip install -r requirements-dev.txt  # Si existe

# Ejecutar tests
python -m pytest tests/ -v

# Verificar tipos
python -m mypy tradeup/

# Formatear c√≥digo
python -m black tradeup/ tests/

# Linting
python -m flake8 tradeup/
```

### Contribuir
1. **Fork** el repositorio
2. **Crear** una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. **Commit** tus cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. **Push** a la rama (`git push origin feature/nueva-funcionalidad`)
5. **Crear** un Pull Request

### Roadmap
- [ ] **Web Dashboard**: Interfaz React para an√°lisis visual
- [ ] **Batch Processing**: An√°lisis de m√∫ltiples contratos
- [ ] **Historical Data**: Tracking de precios hist√≥ricos
- [ ] **Discord Bot**: Notificaciones de oportunidades
- [ ] **Mobile App**: Aplicaci√≥n m√≥vil nativa

## üîß Scripts de Utilidad

### Actualizaci√≥n de Cat√°logo (`fix_grados.py`)
Script que sincroniza el cat√°logo local con datos reales de CSFloat API:

```bash
# Configurar API key
export CSFLOAT_API_KEY="tu_api_key_aqui"  # Linux/macOS
$env:CSFLOAT_API_KEY="tu_api_key_aqui"    # Windows PowerShell

# Ejecutar sincronizaci√≥n
python fix_grados.py

# Usar cat√°logo actualizado
python -m tradeup.cli --contract contracts/ejemplo_contrato.csv --catalog data/skins_fixed.csv
```

#### ¬øQu√© hace el script?
- **Valida rarezas**: Corrige la columna `Grado` consultando CSFloat
- **Detecta inconsistencias**: Reporta diferencias entre cat√°logo local y API
- **Mapeo autom√°tico**: Convierte c√≥digos de rareza (1-7) a nombres legibles
- **Manejo de casos especiales**: Identifica knives/gloves autom√°ticamente
- **Genera reporte**: Lista skins sin datos disponibles

#### Mapeo de Rarezas
| C√≥digo API | Rareza | Color |
|------------|--------|-------|
| 1 | `consumer` | Gris |
| 2 | `industrial` | Celeste |
| 3 | `mil-spec` | Azul |
| 4 | `restricted` | Morado |
| 5 | `classified` | Rosa |
| 6 | `covert` | Rojo |
| 7 | `extraordinary`/`contraband` | Dorado |

## üìä Ejemplos de Contratos

### Contrato B√°sico (Chroma + Prisma 2)
El archivo `contracts/ejemplo_contrato.csv` demuestra un contrato real:
- **5 skins** de "The Chroma Collection" (Mil-Spec)
- **5 skins** de "The Prisma 2 Collection" (Mil-Spec)
- **Objetivo**: Obtener skins Restricted de ambas colecciones
- **Probabilidad**: 50/50 entre las dos colecciones

### Contrato Avanzado (Osiris Supernova)
El archivo `contracts/contrato_osiris_supernova.csv` muestra:
- Contrato enfocado en una skin espec√≠fica de alta demanda
- Optimizaci√≥n de floats para maximizar valor
- An√°lisis de riesgo/recompensa

## ü§ù Comunidad y Soporte

### Reportar Problemas
- **GitHub Issues**: Para bugs y solicitudes de features
- **Discusiones**: Para preguntas generales y estrategias
- **Wiki**: Documentaci√≥n comunitaria y ejemplos

### Recursos √ötiles
- **[TradeUpSpy](https://www.tradeupspy.com/)**: Herramienta de referencia original
- **[CSFloat](https://csfloat.com/)**: Marketplace y API de datos
- **[Steam Market](https://steamcommunity.com/market/)**: Precios de referencia oficiales

## üìÑ Licencia y T√©rminos

### Licencia del Proyecto
Este proyecto est√° licenciado bajo **MIT License** - ver [LICENSE](LICENSE) para detalles.

### T√©rminos de Uso de APIs
- **CSFloat API**: Respetar rate limits y t√©rminos de servicio
- **Steam**: No realizar scraping directo, usar APIs oficiales
- **Uso Responsable**: No automatizar trading sin supervisi√≥n humana

### Disclaimer
- **Sin Garant√≠as**: Los c√°lculos son estimaciones basadas en datos p√∫blicos
- **Riesgo Financiero**: El trading de skins implica riesgo de p√©rdidas
- **Uso Educativo**: Herramienta dise√±ada para aprendizaje y an√°lisis

---

## üåü ¬øTe Gusta el Proyecto?

Si TradeUpSPY te ha sido √∫til:
- ‚≠ê **Dale una estrella** en GitHub
- üêõ **Reporta bugs** para mejorar la herramienta
- üí° **Sugiere features** que te gustar√≠a ver
- ü§ù **Contribuye** con c√≥digo o documentaci√≥n
- üì¢ **Comparte** con otros traders de CS2

**¬°Gracias por usar TradeUpSPY!** üöÄ

---

## üìñ Documentaci√≥n Adicional

Para informaci√≥n m√°s detallada, consulta la documentaci√≥n completa:

- **[üìã Gu√≠a de Contratos](docs/guia_contratos.md)**: Mec√°nicas completas de CS2, f√≥rmulas matem√°ticas y estrategias avanzadas
- **[üåê API CSFloat](docs/api_csfloat.md)**: Documentaci√≥n t√©cnica de integraci√≥n con CSFloat, ejemplos de c√≥digo y mejores pr√°cticas  
- **[üèóÔ∏è Arquitectura](docs/structure.md)**: Estructura del proyecto, patrones de dise√±o y consideraciones futuras
- **[‚öôÔ∏è Stack T√©cnico](docs/tech.md)**: Tecnolog√≠as utilizadas, herramientas de desarrollo y roadmap t√©cnico
- **[üéØ Visi√≥n del Producto](docs/product.md)**: Objetivos, usuarios objetivo, casos de uso y roadmap de funcionalidades

## ü§ù Contribuciones

TradeUpSPY es un proyecto de c√≥digo abierto que se beneficia de las contribuciones de la comunidad. Todas las contribuciones son bienvenidas, desde reportes de bugs hasta nuevas funcionalidades.

### Formas de Contribuir
- üêõ **Reportar Bugs**: Usa GitHub Issues para reportar problemas
- üí° **Sugerir Features**: Prop√≥n nuevas funcionalidades o mejoras
- üìù **Mejorar Documentaci√≥n**: Ayuda a hacer la documentaci√≥n m√°s clara
- üíª **Contribuir C√≥digo**: Implementa fixes o nuevas funcionalidades
- üß™ **Testing**: Ayuda a encontrar y reportar edge cases

### Proceso de Contribuci√≥n
1. Fork el repositorio
2. Crea una rama para tu contribuci√≥n
3. Implementa los cambios con tests
4. Aseg√∫rate de que pasan todos los tests
5. Actualiza la documentaci√≥n si es necesario
6. Crea un Pull Request con descripci√≥n detallada

¬°Esperamos tus contribuciones para hacer TradeUpSPY a√∫n mejor! üåü
